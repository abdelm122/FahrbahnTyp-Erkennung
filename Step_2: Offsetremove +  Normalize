import os
import pandas as pd

# ===== Pfade =====
INPUT_DIR = r"C:\Users\Oulad\Downloads\Devi\Devi_step1"
OUTPUT_DIR = r"C:\Users\Oulad\Downloads\Devi_step2"

# ===== Sensor-Spalten =====
SENSOR_COLS = [
    "AX(g)", "AY(g)", "AZ(g)",
    "GX(deg/s)", "GY(deg/s)", "GZ(deg/s)"
]

EPS = 1e-8  # gegen Division durch 0

# Output Ordner erstellen
if not os.path.exists(OUTPUT_DIR):
    os.makedirs(OUTPUT_DIR)

# ===== durch alle Label-Ordner =====
for label in os.listdir(INPUT_DIR):

    label_path = os.path.join(INPUT_DIR, label)
    if not os.path.isdir(label_path):
        continue

    out_label_path = os.path.join(OUTPUT_DIR, label)
    if not os.path.exists(out_label_path):
        os.makedirs(out_label_path)

    # ===== durch alle CSV-Dateien im Label =====
    for file in os.listdir(label_path):

        if not file.endswith(".csv"):
            continue

        in_file = os.path.join(label_path, file)

        try:
            data = pd.read_csv(in_file)
        except:
            print("Fehler beim Lesen:", in_file)
            continue

        # prüfen ob alle Sensor-Spalten existieren
        ok = True
        for c in SENSOR_COLS:
            if c not in data.columns:
                ok = False
        if not ok:
            print("Spalten fehlen:", in_file)
            continue

        # ===== 1) OFFSET REMOVE (Mittelwert abziehen) =====
        for c in SENSOR_COLS:
            x = data[c].astype(float)
            mean = x.mean()
            data[c] = x - mean

        # ===== 2) NORMALIZE (durch Standardabweichung teilen) =====
        for c in SENSOR_COLS:
            x = data[c].astype(float)
            std = x.std(ddof=0)   # ddof=0 = stabil für ML
            data[c] = x / (std + EPS)

        # speichern
        out_file = os.path.join(out_label_path, file)
        data.to_csv(out_file, index=False)

        print("Gespeichert:", out_file)

print("✅ STEP 2 abgeschlossen")

