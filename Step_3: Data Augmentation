import os
import random
import pandas as pd

# ===== Pfade =====
INPUT_DIR = r"C:\Users\Oulad\Downloads\Devi\Devi_step2"
OUTPUT_DIR = r"C:\Users\Oulad\Downloads\Devi_step3"

# ===== Sensor-Spalten =====
SENSOR_COLS = [
    "AX(g)", "AY(g)", "AZ(g)",
    "GX(deg/s)", "GY(deg/s)", "GZ(deg/s)"
]

# ===== Augmentation Stärke (klein halten, weil Daten schon normalisiert sind) =====
NOISE_STD = 0.03        # kleines Rauschen
SCALE_MIN = 0.95        # Skalierung
SCALE_MAX = 1.05
SHIFT_MAX = 0.05        # kleiner Offset shift (nach Normierung sehr klein)

# Output Ordner erstellen
if not os.path.exists(OUTPUT_DIR):
    os.makedirs(OUTPUT_DIR)

# ===== durch alle Label-Ordner =====
for label in os.listdir(INPUT_DIR):

    label_path = os.path.join(INPUT_DIR, label)
    if not os.path.isdir(label_path):
        continue

    out_label_path = os.path.join(OUTPUT_DIR, label)
    if not os.path.exists(out_label_path):
        os.makedirs(out_label_path)

    # ===== durch alle CSV-Dateien im Label =====
    for file in os.listdir(label_path):

        if not file.endswith(".csv"):
            continue

        in_file = os.path.join(label_path, file)

        try:
            data = pd.read_csv(in_file)
        except:
            print("Fehler beim Lesen:", in_file)
            continue

        # prüfen ob Sensor-Spalten existieren
        ok = True
        for c in SENSOR_COLS:
            if c not in data.columns:
                ok = False
        if not ok:
            print("Spalten fehlen:", in_file)
            continue

        # Original auch kopieren (optional)
        out_orig = os.path.join(out_label_path, file.replace(".csv", "__orig.csv"))
        data.to_csv(out_orig, index=False)

        # ===== 3 Augmentations erzeugen =====
        for aug_id in [1, 2, 3]:

            aug = data.copy()

            # zufällige Parameter pro Aug-Datei
            scale = random.uniform(SCALE_MIN, SCALE_MAX)
            shift = random.uniform(-SHIFT_MAX, SHIFT_MAX)

            # pro Sensor-Spalte verändern
            for c in SENSOR_COLS:
                x = aug[c].astype(float)

                # 1) scaling
                x = x * scale

                # 2) shift
                x = x + shift

                # 3) noise
                noise = [random.gauss(0, NOISE_STD) for _ in range(len(x))]
                x = x + pd.Series(noise)

                aug[c] = x

            out_aug = os.path.join(
                out_label_path,
                file.replace(".csv", f"__aug{aug_id}.csv")
            )
            aug.to_csv(out_aug, index=False)

            print("Gespeichert:", out_aug)

print("✅ STEP 3 abgeschlossen (Augmentation x3)")


